node {
    
    def mvnHome = tool name: 'maven', type: 'maven'

    stage('Checkout') {
       
        git branch: 'main', credentialsId: 'github-creds', url: 'https://github.com/preetishinge/Springboot-sonarqube'
        sh 'ls -la'
    }

    stage('Build') {
        sh "${mvnHome}/bin/mvn clean install"
    }

    stage('Package') {
        sh "${mvnHome}/bin/mvn package"
    }

    stage('SonarQube Analysis') {
        
        withCredentials([string(credentialsId: 'sonarqubetoken', variable: 'SONARQUBE_TOKEN')]) {
            sh """
                ${mvnHome}/bin/mvn sonar:sonar \
                  -Dsonar.projectKey=springboot-demo \
                  -Dsonar.host.url=https://d6312cd2eccd.ngrok-free.app \
                  -Dsonar.login=$SONARQUBE_TOKEN
            """
        }
    }


    }
}
